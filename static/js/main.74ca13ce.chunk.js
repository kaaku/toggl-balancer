(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{169:function(e,t,a){e.exports=a(380)},377:function(e,t,a){},380:function(e,t,a){"use strict";a.r(t);var n=a(65);Object(n.b)();var r=a(163),i=a.n(r),o=a(17),s=a(8),l=a.n(s),c=(a(207),a(152)),u=a(58),m=a(0),d=a.n(m),h=a(22),f=a.n(h);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var g=a(44),p=a(45),y=a(48),b=a(46),E=a(49),D=a(24),v=a(26),k=a.n(v),O=a(19),T=a.n(O),w=a(164),j=a(381),C=a(156),S=a.n(C),M=a(68),Y=a.n(M),R=a(72),B=a.n(R),A=a(69),P=a.n(A),N=a(154),x=a.n(N),I=a(153),z=a.n(I),_=a(155),F=a.n(_),W=a(70),q=a.n(W),L=a(71),H=a.n(L),U=function(e){function t(e){var a;return Object(g.a)(this,t),(a=Object(y.a)(this,Object(b.a)(t).call(this,e))).state={apiToken:e.oldApiToken,rememberMe:!0},a.handleChange=a.handleChange.bind(Object(D.a)(Object(D.a)(a))),a.handleSubmit=a.handleSubmit.bind(Object(D.a)(Object(D.a)(a))),a.handleCancel=a.handleCancel.bind(Object(D.a)(Object(D.a)(a))),a}return Object(E.a)(t,e),Object(p.a)(t,[{key:"handleChange",value:function(e){this.setState({apiToken:e.target.value})}},{key:"handleSubmit",value:function(){var e=this.props.onClose,t=this.state;e({apiToken:t.apiToken,rememberMe:t.rememberMe})}},{key:"handleCancel",value:function(){(0,this.props.onClose)({})}},{key:"render",value:function(){var e=this,t=this.props,a=t.open,n=t.mandatory,r=this.state,i=r.apiToken,o=r.rememberMe;return d.a.createElement(Y.a,{open:a,disableBackdropClick:n,disableEscapeKeyDown:n,"aria-labelledby":"form-dialog-title"},d.a.createElement(z.a,{id:"form-dialog-title"},"Enter your Toggl API Token"),d.a.createElement(P.a,null,d.a.createElement(x.a,null,"Your Toggl time entries will be fetched using your API Token, which you can find from your"," ",d.a.createElement("a",{href:"https://www.toggl.com/app/profile",target:"_blank",rel:"noopener noreferrer"},"Toggl profile ",d.a.createElement(q.a,{fontSize:"small"},"open_in_new"))),d.a.createElement(H.a,{type:"password",autoFocus:!0,fullWidth:!0,margin:"dense",label:"API Token",value:i,onChange:this.handleChange}),d.a.createElement(F.a,{control:d.a.createElement(S.a,{color:"primary",checked:o,onChange:function(t,a){return e.setState({rememberMe:a})}}),label:"Remember me"})),d.a.createElement(B.a,null,!n&&d.a.createElement(k.a,{color:"primary",onClick:this.handleCancel},"Cancel"),d.a.createElement(k.a,{variant:"contained",color:"primary",onClick:this.handleSubmit,disabled:!i},"Submit")))}}]),t}(m.Component);U.defaultProps={oldApiToken:"",open:!0,mandatory:!1};var V=Object(o.withStyles)({},{withTheme:!0})(U),J=a(11),G=a(20),K=a.n(G),$=function(e){var t=e.duration,a=e.useColors,n=e.textProps,r=0===t?"":t>0?"+":"-",i=l.a.duration(Math.abs(t),"seconds"),o="".concat(Math.floor(i.asHours()),":").concat(i.minutes().toString().padStart(2,"0"));return a&&(n.color=t<0?"error":"primary"),d.a.createElement(K.a,n,r,o)};$.defaultProps={useColors:!1,textProps:{}};var Q=Object(o.withStyles)({},{withTheme:!0})($),X=a(7),Z=a.n(X),ee=a(34),te=a.n(ee),ae=a(158),ne=a.n(ae),re=a(157),ie=function(e){var t=e.size,a=e.visible,n=e.classes;return a?d.a.createElement(ne.a,{title:"You have a running time entry",placement:"top"},d.a.createElement(q.a,{fontSize:t,className:n.root},"fiber_manual_record")):null};ie.defaultProps={size:"default",visible:!0};var oe=Object(o.withStyles)(function(e){return{root:{color:re.red[500],marginLeft:2*e.spacing.unit,verticalAlign:"top",animation:"blinker 2s cubic-bezier(0.46, 0.03, 0.52, 0.96) infinite"}}},{withTheme:!0})(ie),se=function(e){var t=e.date,a=e.duration,n=e.hasRunningEntry,r=e.disabled,i=e.classes,o=l()().isSame(t,"day");return d.a.createElement(te.a,{className:Z()(i.calendarCell,Object(J.a)({},i.disabled,r))},d.a.createElement(K.a,{variant:"overline",inline:!0,gutterBottom:!0,className:Z()(i.dayOfMonth,Object(J.a)({},i.today,o))},l()(t).format("DD")),d.a.createElement(oe,{size:"small",visible:n}),Number.isSafeInteger(a)&&d.a.createElement(Q,{duration:a,useColors:!0,textProps:{variant:"h6",align:"center"}}),!r&&!Number.isSafeInteger(a)&&d.a.createElement(K.a,{variant:"h6",color:"textSecondary",align:"center"},"-"))};se.defaultProps={duration:null,hasRunningEntry:!1,disabled:!1};var le=Object(o.withStyles)(function(e){return{calendarCell:{padding:10,height:"100%"},disabled:{backgroundColor:e.palette.action.disabledBackground},dayOfMonth:{padding:3},today:{borderRadius:"50%",backgroundColor:e.palette.primary.main,color:e.palette.primary.contrastText,fontWeight:e.typography.fontWeightMedium}}},{withTheme:!0})(se);var ce=Object(o.withStyles)({},{withTheme:!0})(function(e){for(var t=e.year,a=e.month,n=e.timeEntriesByDate,r=l()({year:t,month:a-1,day:1}),i=l()(r).startOf("week"),o=l()(r).endOf("month").startOf("day"),s=l()(o).endOf("week").startOf("day"),c=[],u=[],m=Math.round(l.a.duration(s.diff(i)).asDays())+1;c.length<m;)c.push(l()(i).add(c.length,"days").format("YYYY-MM-DD"));for(;c.length>0;)u.push(c.splice(0,7));var h=function(e,t,a){for(var n={},r=l()(t);r.isSameOrBefore(a,"day");){var i=r.format("YYYY-MM-DD");n[i]=Object.assign({duration:null,hasRunningEntry:!1},e[i]),r=r.add(1,"day")}return n}(n,i,s);return d.a.createElement(d.a.Fragment,null,u.map(function(e){return d.a.createElement(T.a,{container:!0,spacing:16,key:l()(e[0]).week()},e.map(function(e){return d.a.createElement(T.a,{item:!0,xs:!0,key:e},d.a.createElement(le,{date:e,duration:h[e].duration,hasRunningEntry:h[e].hasRunningEntry,disabled:!r.isSame(e,"month")}))}))}))});function ue(e,t){return Object.keys(e).filter(function(e){return l()(e).month()===t}).reduce(function(t,a){return Object.assign(t,Object(J.a)({},a,e[a]))},{})}var me=Object(o.withStyles)(function(e){return{root:{padding:10*e.spacing.unit}}},{withTheme:!0})(function(e){var t=e.startDate,a=e.endDate,n=e.timeEntriesByDate,r=e.classes;if(t.isAfter(a))return null;var i=function(e,t,a){for(var n=[],r=l()(e).startOf("month");r.isSameOrBefore(t,"day");){var i=ue(a,r.month());n.push({firstDayOfMonth:r,totalDiff:Object.values(i).reduce(function(e,t){return e+t.duration},0)}),r=l()(r).add(1,"month")}return n}(t,a,n);return d.a.createElement(T.a,{container:!0,justify:"center",spacing:40,className:r.root},i.map(function(e){var t=e.firstDayOfMonth,a=e.totalDiff;return d.a.createElement(T.a,{item:!0,xs:12,lg:6,key:t.format("YYYY-MM")},d.a.createElement(T.a,{container:!0,justify:"space-between"},d.a.createElement(T.a,{item:!0},d.a.createElement(K.a,{variant:"h2",gutterBottom:!0},t.format("MMMM YYYY"))),d.a.createElement(T.a,{item:!0},d.a.createElement(Q,{duration:a,useColors:!0,textProps:{variant:"h2",gutterBottom:!0}}))),d.a.createElement(ce,{year:t.year(),month:t.month()+1,timeEntriesByDate:ue(n,t.month())}))}))}),de=[{title:"Last month",getDateRange:function(){return{startDate:l()().subtract(1,"month").startOf("month"),endDate:l()().startOf("month").subtract(1,"day")}}},{title:"This month",getDateRange:function(){return{startDate:l()().startOf("month"),endDate:l()().endOf("month").startOf("day")}},default:!0},{title:"This year",getDateRange:function(){return{startDate:l()().startOf("year"),endDate:l()().endOf("month").startOf("day")}}}],he=Object(o.withStyles)(function(e){return{root:{padding:5*e.spacing.unit},quickSelections:{marginTop:2*e.spacing.unit}}},{withTheme:!0})(function(e){var t=e.startDate,a=e.endDate,n=e.onChange,r=e.classes,i=l()().year();return d.a.createElement(te.a,{className:r.root},d.a.createElement(T.a,{container:!0,justify:"space-evenly",spacing:40},d.a.createElement(T.a,{item:!0},d.a.createElement(u.a,{label:"From",format:t&&t.year()!==i?"MMMM Do, YYYY":"MMMM Do",value:t,maxDate:a,autoOk:!0,showTodayButton:!0,onChange:function(e){return n({startDate:e,endDate:a})}})),d.a.createElement(T.a,{item:!0},d.a.createElement(u.a,{label:"To",format:a&&a.year()!==i?"MMMM Do, YYYY":"MMMM Do",value:a,minDate:t,autoOk:!0,showTodayButton:!0,onChange:function(e){return n({startDate:t,endDate:e})}}))),d.a.createElement(T.a,{container:!0,justify:"space-evenly",spacing:40,className:r.quickSelections},de.map(function(e){return d.a.createElement(T.a,{item:!0,key:e.title},d.a.createElement(k.a,{onClick:function(){return n(e.getDateRange())},size:"small"},e.title))})))}),fe=de.find(function(e){return e.default}).getDateRange(),ge=l.a.duration("7:30").asSeconds();function pe(e){return e.map(function(e){return Object.assign(e,{start:l()(e.start),end:l()(e.end),duration:e.duration<0?l()().unix()+e.duration:e.duration,isRunning:e.duration<0})}).sort(function(e,t){return e.start.diff(t.start)}).reduce(function(e,t){var a=l()(t.start).format("YYYY-MM-DD"),n=e[a]||{timeEntries:[],duration:-ge,hasRunningEntry:!1};return n.timeEntries.push(t),n.duration+=t.duration,n.hasRunningEntry=n.hasRunningEntry||t.isRunning,Object.assign(e,Object(J.a)({},a,n))},{})}var ye=function(e,t,a){if(!e&&!t)throw Error("Either start date or end date is required");if(!a)throw Error("API token is required");var n=e?l()(e).startOf("day"):null,r=t?l()(t).add(1,"day").startOf("day"):null;if(n&&!n.isValid()||r&&!r.isValid())throw Error("Start date and/or end date were invalid");var i=new URL("https://www.toggl.com/api/v8/time_entries"),o={};return n&&(o.start_date=n.toISOString()),r&&(o.end_date=r.toISOString()),i.search=new URLSearchParams(o),fetch(i,{method:"GET",headers:new Headers({Authorization:"Basic ".concat(btoa("".concat(a,":api_token"))),"Content-Type":"application/json"})}).catch(function(){throw Error("Failed to fetch time entries, check your internet connection")}).then(function(e){if(e.ok)return e.json();if(403===e.status)throw Error("Toggl authentication failed, maybe the API token is incorrect?");throw Error("Toggl responded with an unknown error (HTTP ".concat(e.status,")"))}).then(pe)},be=(a(377),function(e){function t(e){var a;Object(g.a)(this,t),a=Object(y.a)(this,Object(b.a)(t).call(this,e));var n=localStorage,r=n.apiToken,i=n.startDate,o=n.endDate,s=i&&o?{startDate:l()(i),endDate:l()(o)}:fe;return a.state=Object.assign({apiToken:r,timeEntriesByDate:{},showApiTokenDialog:!r},s),a.handleDialogClose=a.handleDialogClose.bind(Object(D.a)(Object(D.a)(a))),a.handleDateRangeChange=a.handleDateRangeChange.bind(Object(D.a)(Object(D.a)(a))),a}return Object(E.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.state.apiToken&&this.updateTimeEntries()}},{key:"componentDidUpdate",value:function(e,t){var a=this.state,n=a.startDate,r=a.endDate,i=a.apiToken;t.startDate===n&&t.endDate===r&&t.apiToken===i||this.updateTimeEntries()}},{key:"updateTimeEntries",value:function(){var e=this,t=this.state,a=t.startDate,n=t.endDate,r=t.apiToken;try{ye(a,n,r).then(function(t){return e.setState({timeEntriesByDate:t,error:void 0})},function(t){return e.setState({timeEntriesByDate:{},error:t.message})})}catch(o){var i=o.message;this.setState({error:i})}}},{key:"handleDialogClose",value:function(e){var t=e.apiToken,a=e.rememberMe,n={showApiTokenDialog:!1};t&&(a?localStorage.setItem("apiToken",t):localStorage.removeItem("apiToken"),Object.assign(n,{apiToken:t})),this.setState(n)}},{key:"handleDateRangeChange",value:function(e){Object.keys(e).forEach(function(t){return localStorage.setItem(t,e[t].format("YYYY-MM-DD"))}),this.setState(e)}},{key:"render",value:function(){var e=this,t=this.state,a=t.startDate,n=t.endDate,r=t.apiToken,i=t.showApiTokenDialog,o=t.timeEntriesByDate,s=t.error,l=this.props.classes;if(!r)return d.a.createElement(V,{mandatory:!0,onClose:this.handleDialogClose});var c=Object.values(o).reduce(function(e,t){return e+t.duration},0),u=Object.values(o).some(function(e){return e.hasRunningEntry});return d.a.createElement(d.a.Fragment,null,d.a.createElement(V,{open:i,mandatory:!1,oldApiToken:r,onClose:this.handleDialogClose}),d.a.createElement(k.a,{className:l.changeApiToken,color:"primary",onClick:function(){return e.setState({showApiTokenDialog:!0})}},"Change API Token"),d.a.createElement(T.a,{container:!0,justify:"center",className:l.dateSelectorContainer},d.a.createElement(T.a,{item:!0},d.a.createElement(he,{startDate:a,endDate:n,onChange:this.handleDateRangeChange})),!a.isSame(n,"month")&&d.a.createElement(T.a,{item:!0,xs:12},d.a.createElement(j.a,{variant:"h2",align:"center",className:l.totalTimeDiff},"Total: ",d.a.createElement(Q,{duration:c,useColors:!0,textProps:{variant:"inherit",inline:!0}}),d.a.createElement(oe,{size:"large",visible:u}))),s&&d.a.createElement(T.a,{item:!0},d.a.createElement(w.a,{className:l.errorNotification,message:s}))),Object.keys(o).length>0&&d.a.createElement(me,{startDate:a,endDate:n,timeEntriesByDate:o}))}}]),t}(m.Component)),Ee=Object(o.withStyles)(function(e){return{changeApiToken:{position:"absolute",top:2*e.spacing.unit,right:2*e.spacing.unit},dateSelectorContainer:{marginTop:5*e.spacing.unit},totalTimeDiff:{marginTop:3*e.spacing.unit},errorNotification:{marginTop:3*e.spacing.unit,backgroundColor:e.palette.error.main}}},{withTheme:!0})(be);l.a.locale("en-gb");var De=Object(o.createMuiTheme)({typography:{useNextVariants:!0}});f.a.render(d.a.createElement(n.a,{theme:De},d.a.createElement(i.a,null),d.a.createElement(u.b,{utils:c.a},d.a.createElement(Ee,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[169,2,1]]]);
//# sourceMappingURL=main.74ca13ce.chunk.js.map