(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{172:function(e,t,a){e.exports=a(383)},380:function(e,t,a){},383:function(e,t,a){"use strict";a.r(t);var n=a(65);Object(n.b)();var r=a(165),i=a.n(r),o=a(17),s=a(8),l=a.n(s),c=(a(210),a(153)),u=a(58),d=a(0),m=a.n(d),h=a(23),f=a.n(h);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var g=a(11),y=a(44),p=a(45),E=a(48),b=a(46),v=a(49),k=a(24),D=a(26),O=a.n(D),w=a(19),T=a.n(w),j=a(167),C=a(384),S=a(157),M=a.n(S),Y=a(68),R=a.n(Y),x=a(72),B=a.n(x),P=a(69),W=a.n(P),A=a(155),N=a.n(A),I=a(154),z=a.n(I),_=a(156),F=a.n(_),q=a(70),J=a.n(q),L=a(71),H=a.n(L),U=function(e){function t(e){var a;return Object(y.a)(this,t),(a=Object(E.a)(this,Object(b.a)(t).call(this,e))).state={apiToken:e.oldApiToken,rememberMe:!0},a.handleChange=a.handleChange.bind(Object(k.a)(Object(k.a)(a))),a.handleSubmit=a.handleSubmit.bind(Object(k.a)(Object(k.a)(a))),a.handleCancel=a.handleCancel.bind(Object(k.a)(Object(k.a)(a))),a}return Object(v.a)(t,e),Object(p.a)(t,[{key:"handleChange",value:function(e){this.setState({apiToken:e.target.value})}},{key:"handleSubmit",value:function(){var e=this.props.onClose,t=this.state;e({apiToken:t.apiToken,rememberMe:t.rememberMe})}},{key:"handleCancel",value:function(){(0,this.props.onClose)({})}},{key:"render",value:function(){var e=this,t=this.props,a=t.open,n=t.mandatory,r=this.state,i=r.apiToken,o=r.rememberMe;return m.a.createElement(R.a,{open:a,disableBackdropClick:n,disableEscapeKeyDown:n,"aria-labelledby":"form-dialog-title"},m.a.createElement(z.a,{id:"form-dialog-title"},"Enter your Toggl API Token"),m.a.createElement(W.a,null,m.a.createElement(N.a,null,"Your Toggl time entries will be fetched using your API Token, which you can find from your"," ",m.a.createElement("a",{href:"https://www.toggl.com/app/profile",target:"_blank",rel:"noopener noreferrer"},"Toggl profile ",m.a.createElement(J.a,{fontSize:"small"},"open_in_new"))),m.a.createElement(H.a,{type:"password",autoFocus:!0,fullWidth:!0,margin:"dense",label:"API Token",value:i,onChange:this.handleChange}),m.a.createElement(F.a,{control:m.a.createElement(M.a,{color:"primary",checked:o,onChange:function(t,a){return e.setState({rememberMe:a})}}),label:"Remember me"})),m.a.createElement(B.a,null,!n&&m.a.createElement(O.a,{color:"primary",onClick:this.handleCancel},"Cancel"),m.a.createElement(O.a,{variant:"contained",color:"primary",onClick:this.handleSubmit,disabled:!i},"Submit")))}}]),t}(d.Component);U.defaultProps={oldApiToken:"",open:!0,mandatory:!1};var V=Object(o.withStyles)({},{withTheme:!0})(U),G=a(20),K=a.n(G),$=function(e){var t=e.duration,a=e.useColors,n=e.textProps,r=0===t?"":t>0?"+":"-",i=l.a.duration(Math.abs(t),"seconds"),o="".concat(Math.floor(i.asHours()),":").concat(i.minutes().toString().padStart(2,"0"));return a&&(n.color=t<0?"error":"primary"),m.a.createElement(K.a,n,r,o)};$.defaultProps={useColors:!1,textProps:{}};var Q=Object(o.withStyles)({},{withTheme:!0})($),X=a(7),Z=a.n(X),ee=a(34),te=a.n(ee),ae=a(160),ne=a.n(ae),re=a(159),ie=a.n(re),oe=a(158),se=function(e){var t=e.size,a=e.visible,n=e.classes;return a?m.a.createElement(ie.a,{title:"You have a running time entry",placement:"top"},m.a.createElement(J.a,{fontSize:t,className:n.root},"fiber_manual_record")):null};se.defaultProps={size:"default",visible:!0};var le=Object(o.withStyles)(function(e){return{root:{color:oe.red[500],marginLeft:2*e.spacing.unit,verticalAlign:"top",animation:"blinker 2s cubic-bezier(0.46, 0.03, 0.52, 0.96) infinite"}}},{withTheme:!0})(se),ce=m.a.createContext({timeEntriesByDate:{},workdayOverrides:{},toggleWorkday:function(){}}),ue=a(166),de=l.a.duration("7:30").asSeconds();var me={fetchTimeEntries:function(e,t,a,n){if(!e&&!t)throw Error("Either start date or end date is required");if(!a)throw Error("API token is required");var r=e?l()(e).startOf("day"):null,i=t?l()(t).add(1,"day").startOf("day"):null;if(r&&!r.isValid()||i&&!i.isValid())throw Error("Start date and/or end date were invalid");var o=new URL("https://www.toggl.com/api/v8/time_entries"),s={};return r&&(s.start_date=r.toISOString()),i&&(s.end_date=i.toISOString()),o.search=new URLSearchParams(s),fetch(o,{method:"GET",headers:new Headers({Authorization:"Basic ".concat(btoa("".concat(a,":api_token"))),"Content-Type":"application/json"})}).catch(function(){throw Error("Failed to fetch time entries, check your internet connection")}).then(function(e){if(e.ok)return e.json();if(403===e.status)throw Error("Toggl authentication failed, maybe the API token is incorrect?");throw Error("Toggl responded with an unknown error (HTTP ".concat(e.status,")"))}).then(function(e){return function(e,t,a,n){for(var r=a.map(function(e){return Object.assign(e,{start:l()(e.start),end:l()(e.end),duration:e.duration<0?l()().unix()+e.duration:e.duration,isRunning:e.duration<0})}).sort(function(e,t){return e.start.diff(t.start)}).reduce(function(e,t){var a=l()(t.start).format("YYYY-MM-DD"),r=e[a]||{timeEntries:[],duration:me.isWorkday(a,n,!0)?-de:0,hasRunningEntry:!1};return r.timeEntries.push(t),r.duration+=t.duration,r.hasRunningEntry=r.hasRunningEntry||t.isRunning,Object.assign(e,Object(g.a)({},a,r))},{}),i=e;i.isBefore(t,"day");){var o=i.format("YYYY-MM-DD");r.hasOwnProperty(o)||(r[o]={timeEntries:[],duration:me.isWorkday(o,n,!1)?-de:null,hasRunningEntry:!1}),i=i.add(1,"day")}return r}(r,i,e,n)})},refreshDurations:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};return Object.entries(t).forEach(function(t){var r=Object(ue.a)(t,2),i=r[0],o=r[1],s=o.timeEntries.length>0,l=e.isWorkday(i,a,s),c=null;(s||l)&&(c=o.timeEntries.map(function(e){return e.duration}).reduce(function(e,t){return e+t},0)+(l?-de:0));n[i]=Object.assign({},o,{duration:c})}),n},isWorkday:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t.hasOwnProperty(e)?t[e]:![6,7].includes(l()(e).isoWeekday())&&a}},he=function(e){var t=e.date,a=e.duration,n=e.hasRunningEntry,r=e.disabled,i=e.classes,o=l()().isSame(t,"day"),s=Number.isSafeInteger(a);return m.a.createElement(ce.Consumer,null,function(e){var c=e.workdayOverrides,u=e.toggleWorkday;return m.a.createElement(te.a,{className:Z()(i.calendarCell,Object(g.a)({},i.disabled,r))},m.a.createElement(K.a,{variant:"overline",inline:!0,gutterBottom:!0,className:Z()(i.dayOfMonth,Object(g.a)({},i.today,o))},l()(t).format("DD")),m.a.createElement(le,{size:"small",visible:n}),!r&&m.a.createElement(ne.a,{checked:me.isWorkday(t,c,s),onChange:function(){return u(t)},color:"primary"}),s&&m.a.createElement(Q,{duration:a,useColors:!0,textProps:{variant:"h6",align:"center"}}),!r&&!s&&m.a.createElement(K.a,{variant:"h6",color:"textSecondary",align:"center"},"-"))})};he.defaultProps={duration:null,hasRunningEntry:!1,disabled:!1};var fe=Object(o.withStyles)(function(e){return{calendarCell:{padding:10,height:"100%"},disabled:{backgroundColor:e.palette.action.disabledBackground},dayOfMonth:{padding:3},today:{borderRadius:"50%",backgroundColor:e.palette.primary.main,color:e.palette.primary.contrastText,fontWeight:e.typography.fontWeightMedium}}},{withTheme:!0})(he);var ge=Object(o.withStyles)({},{withTheme:!0})(function(e){for(var t=e.year,a=e.month,n=e.timeEntriesByDate,r=l()({year:t,month:a-1,day:1}),i=l()(r).startOf("week"),o=l()(r).endOf("month").startOf("day"),s=l()(o).endOf("week").startOf("day"),c=[],u=[],d=Math.round(l.a.duration(s.diff(i)).asDays())+1;c.length<d;)c.push(l()(i).add(c.length,"days").format("YYYY-MM-DD"));for(;c.length>0;)u.push(c.splice(0,7));var h=function(e,t,a){for(var n={},r=l()(t);r.isSameOrBefore(a,"day");){var i=r.format("YYYY-MM-DD");n[i]=Object.assign({duration:null,hasRunningEntry:!1},e[i]),r=r.add(1,"day")}return n}(n,i,s);return m.a.createElement(m.a.Fragment,null,u.map(function(e){return m.a.createElement(T.a,{container:!0,spacing:16,key:l()(e[0]).week()},e.map(function(e){return m.a.createElement(T.a,{item:!0,xs:!0,key:e},m.a.createElement(fe,{date:e,duration:h[e].duration,hasRunningEntry:h[e].hasRunningEntry,disabled:!r.isSame(e,"month")}))}))}))});function ye(e,t){return Object.keys(e).filter(function(e){return l()(e).month()===t}).reduce(function(t,a){return Object.assign(t,Object(g.a)({},a,e[a]))},{})}var pe=Object(o.withStyles)(function(e){return{root:{padding:10*e.spacing.unit}}},{withTheme:!0})(function(e){var t=e.startDate,a=e.endDate,n=e.timeEntriesByDate,r=e.classes;if(t.isAfter(a))return null;var i=function(e,t,a){for(var n=[],r=l()(e).startOf("month");r.isSameOrBefore(t,"day");){var i=ye(a,r.month());n.push({firstDayOfMonth:r,totalDiff:Object.values(i).reduce(function(e,t){return e+t.duration},0)}),r=l()(r).add(1,"month")}return n}(t,a,n);return m.a.createElement(T.a,{container:!0,justify:"center",spacing:40,className:r.root},i.map(function(e){var t=e.firstDayOfMonth,a=e.totalDiff;return m.a.createElement(T.a,{item:!0,xs:12,lg:6,key:t.format("YYYY-MM")},m.a.createElement(T.a,{container:!0,justify:"space-between"},m.a.createElement(T.a,{item:!0},m.a.createElement(K.a,{variant:"h2",gutterBottom:!0},t.format("MMMM YYYY"))),m.a.createElement(T.a,{item:!0},m.a.createElement(Q,{duration:a,useColors:!0,textProps:{variant:"h2",gutterBottom:!0}}))),m.a.createElement(ge,{year:t.year(),month:t.month()+1,timeEntriesByDate:ye(n,t.month())}))}))}),Ee=[{title:"Last month",getDateRange:function(){return{startDate:l()().subtract(1,"month").startOf("month"),endDate:l()().startOf("month").subtract(1,"day")}}},{title:"This month",getDateRange:function(){return{startDate:l()().startOf("month"),endDate:l()().endOf("month").startOf("day")}},default:!0},{title:"This year",getDateRange:function(){return{startDate:l()().startOf("year"),endDate:l()().endOf("month").startOf("day")}}}],be=Object(o.withStyles)(function(e){return{root:{padding:5*e.spacing.unit},quickSelections:{marginTop:2*e.spacing.unit}}},{withTheme:!0})(function(e){var t=e.startDate,a=e.endDate,n=e.onChange,r=e.classes,i=l()().year();return m.a.createElement(te.a,{className:r.root},m.a.createElement(T.a,{container:!0,justify:"space-evenly",spacing:40},m.a.createElement(T.a,{item:!0},m.a.createElement(u.a,{label:"From",format:t&&t.year()!==i?"MMMM Do, YYYY":"MMMM Do",value:t,maxDate:a,autoOk:!0,showTodayButton:!0,onChange:function(e){return n({startDate:e,endDate:a})}})),m.a.createElement(T.a,{item:!0},m.a.createElement(u.a,{label:"To",format:a&&a.year()!==i?"MMMM Do, YYYY":"MMMM Do",value:a,minDate:t,autoOk:!0,showTodayButton:!0,onChange:function(e){return n({startDate:t,endDate:e})}}))),m.a.createElement(T.a,{container:!0,justify:"space-evenly",spacing:40,className:r.quickSelections},Ee.map(function(e){return m.a.createElement(T.a,{item:!0,key:e.title},m.a.createElement(O.a,{onClick:function(){return n(e.getDateRange())},size:"small"},e.title))})))}),ve=Ee.find(function(e){return e.default}).getDateRange(),ke=(a(380),function(e){function t(e){var a;Object(y.a)(this,t),a=Object(E.a)(this,Object(b.a)(t).call(this,e));var n=localStorage,r=n.apiToken,i=n.startDate,o=n.endDate,s=n.workdayOverrides,c={};try{s&&(c=JSON.parse(s))}catch(d){console.warn("Couldn't parse workday overrides from localStorage: ".concat(s)),c={}}var u=i&&o?{startDate:l()(i),endDate:l()(o)}:ve;return a.handleDialogClose=a.handleDialogClose.bind(Object(k.a)(Object(k.a)(a))),a.handleDateRangeChange=a.handleDateRangeChange.bind(Object(k.a)(Object(k.a)(a))),a.toggleWorkday=a.toggleWorkday.bind(Object(k.a)(Object(k.a)(a))),a.state={apiToken:r,showApiTokenDialog:!r,startDate:u.startDate,endDate:u.endDate,timeEntryContext:{timeEntriesByDate:{},workdayOverrides:c,toggleWorkday:a.toggleWorkday}},a}return Object(v.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.state.apiToken&&this.updateTimeEntries()}},{key:"componentDidUpdate",value:function(e,t){var a=this.state,n=a.startDate,r=a.endDate,i=a.apiToken;t.startDate===n&&t.endDate===r&&t.apiToken===i||this.updateTimeEntries()}},{key:"toggleWorkday",value:function(e){var t=this.state,a=t.timeEntryContext,n=t.timeEntryContext,r=n.workdayOverrides,i=n.timeEntriesByDate,o=me.isWorkday(e,r,i[e].timeEntries.length>0),s=Object.assign({},r,Object(g.a)({},e,!o)),l=me.refreshDurations(i,s);localStorage.setItem("workdayOverrides",JSON.stringify(s)),this.setState({timeEntryContext:Object.assign({},a,{timeEntriesByDate:l,workdayOverrides:s})})}},{key:"updateTimeEntries",value:function(){var e=this,t=this.state,a=t.startDate,n=t.endDate,r=t.apiToken,i=t.timeEntryContext;try{me.fetchTimeEntries(a,n,r,i.workdayOverrides).then(function(t){return e.setState({timeEntryContext:Object.assign({},i,{timeEntriesByDate:t}),error:void 0})},function(t){return e.setState({timeEntryContext:Object.assign({},i,{timeEntriesByDate:{}}),error:t.message})})}catch(s){var o=s.message;this.setState({error:o})}}},{key:"handleDialogClose",value:function(e){var t=e.apiToken,a=e.rememberMe,n={showApiTokenDialog:!1};t&&(a?localStorage.setItem("apiToken",t):localStorage.removeItem("apiToken"),Object.assign(n,{apiToken:t})),this.setState(n)}},{key:"handleDateRangeChange",value:function(e){Object.keys(e).forEach(function(t){return localStorage.setItem(t,e[t].format("YYYY-MM-DD"))}),this.setState(e)}},{key:"render",value:function(){var e=this,t=this.state,a=t.startDate,n=t.endDate,r=t.apiToken,i=t.showApiTokenDialog,o=t.timeEntryContext,s=t.timeEntryContext.timeEntriesByDate,l=t.error,c=this.props.classes;if(!r)return m.a.createElement(V,{mandatory:!0,onClose:this.handleDialogClose});var u=Object.values(s).reduce(function(e,t){return e+t.duration},0),d=Object.values(s).some(function(e){return e.hasRunningEntry});return m.a.createElement(m.a.Fragment,null,m.a.createElement(V,{open:i,mandatory:!1,oldApiToken:r,onClose:this.handleDialogClose}),m.a.createElement(O.a,{className:c.changeApiToken,color:"primary",onClick:function(){return e.setState({showApiTokenDialog:!0})}},"Change API Token"),m.a.createElement(T.a,{container:!0,justify:"center",className:c.dateSelectorContainer},m.a.createElement(T.a,{item:!0},m.a.createElement(be,{startDate:a,endDate:n,onChange:this.handleDateRangeChange})),!a.isSame(n,"month")&&m.a.createElement(T.a,{item:!0,xs:12},m.a.createElement(C.a,{variant:"h2",align:"center",className:c.totalTimeDiff},"Total: ",m.a.createElement(Q,{duration:u,useColors:!0,textProps:{variant:"inherit",inline:!0}}),m.a.createElement(le,{size:"large",visible:d}))),l&&m.a.createElement(T.a,{item:!0},m.a.createElement(j.a,{className:c.errorNotification,message:l}))),Object.keys(s).length>0&&m.a.createElement(ce.Provider,{value:o},m.a.createElement(pe,{startDate:a,endDate:n,timeEntriesByDate:s})))}}]),t}(d.Component)),De=Object(o.withStyles)(function(e){return{changeApiToken:{position:"absolute",top:2*e.spacing.unit,right:2*e.spacing.unit},dateSelectorContainer:{marginTop:5*e.spacing.unit},totalTimeDiff:{marginTop:3*e.spacing.unit},errorNotification:{marginTop:3*e.spacing.unit,backgroundColor:e.palette.error.main}}},{withTheme:!0})(ke);l.a.locale("en-gb");var Oe=Object(o.createMuiTheme)({typography:{useNextVariants:!0}});f.a.render(m.a.createElement(n.a,{theme:Oe},m.a.createElement(i.a,null),m.a.createElement(u.b,{utils:c.a},m.a.createElement(De,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[172,2,1]]]);
//# sourceMappingURL=main.c4fc49dd.chunk.js.map